@{
    ViewBag.Title = "Index";
}
<style>
    .backcolour table thead tr {
        background-color: white;
        color: black;
        font-display: block;
    }

    body {
        background-repeat: no-repeat;
        background-size: cover;
        margin-bottom:20px;
    }

    #hms {
        padding-top: 1px;
        padding-left: 60px;
        color: black;
        font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
        font-size: xx-large;
        font-weight: 700;
    }
    h3 {
        color: white;
        font-family: 'Gill Sans', 'Gill Sans MT', Calibri, 'Trebuchet MS', sans-serif;
    }
</style>

<link href="https://cdn.datatables.net/1.11.3/css/jquery.dataTables.min.css" rel="stylesheet" />

<script>
    var dataTable;
    $(document).ready(function () {
        dataTable=$('#myTable').DataTable(
            {
                "processing": true,
                "serverSide": true,
                "filter": true,
                "dom": '<"top"Bf>rt<"bottom"ilp><"clear">',
                buttons: [
                    {
                        extend: 'excel',
                        title: "Hospital Management System",
                        autoFilter: true,
                        exportOptions: {
                            columns: [0, 1, 2, 3, 4, 5]
                        }
                    },
                    {
                        extend: 'pdf',
                        title:"Hospital Management System",
                        download:'open',
                        exportOptions: {
                            columns: [0, 1, 2, 3, 4, 5]
                        },
                        customize: function (doc) {
                            doc.defaultStyle.alignment = 'center';
                            doc.styles.tableHeader.alignment = 'center';
                            doc.content[1].table.widths = Array(doc.content[1].table.body[0].length + 1).join('*').split('');
                            doc.content[1].table.headerRows = 1;
                        }
                    },
                    {
                        extend: 'print',
                        title: "Hospital Management System",
                        exportOptions: {
                            columns: [0, 1, 2, 3, 4, 5]
                        }
                    }
                ],
                "scrollY":"380PX",
                "scrollCollapse":false,
                
                "columnDefs": [{  "targets": [1, 2,3, 4, 5, 6, 7], className: 'dt-head-center dt-body-center' },
                    {
                    'targets': [5,7],
                    'orderable': false,
                }],
           
            


                "ajax": {
                    "url": "/Patients/GetPat",
                    "type": "POST",
                    "datatype": "json"
                },
                "columns": [
                    {
                        "data": "Name",
                        "name": "Name",
                        "width": "17%",

                      
                    },
                    {
                        "data": "Age",
                        "name": "Age",
                        "width": "7%",

                    },
                    {
                        "data": "Gender",
                        "name": "Gender",
                        "width": "10%",

                    },
                    {
                        "data": "Department",
                        "name": "Department",
                        "width": "8%",

                    },
                    {
                        "data": "CovidTestResult",
                        "CovidTestResult": "Name",
                        "width": "16%",

                    },
                    {
                        "data": "Contact",
                        "name": "Contact",
                        "width": "10%",

                    },
                    {
                        "data": "InPatient",
                        "name": "InPatient",
                        "type": "bool",
                        "width":"11%",
                        "render": function (value) {
                            if (value === true) return "Yes";
                            else return "No";
                        }
                    },
                    {
                        "data": "Id",
                        "width":"40%",
                        "render": function (data,type,full,meta) {

                            return '<a class="blue" title="View" onclick="viewPatient(' + full.Id + ')" ><span class="glyphicon glyphicon-eye-open"></span></a> <a class="Yellow space" title="Edit" onclick="viewEdit(' + full.Id + ')"><span class="glyphicon glyphicon-pencil"></span></a>  <a class="Red" title="Delete" onclick="viewdelete(' + full.Id + ')"><span class="glyphicon glyphicon-trash"></span></a>';
                        }
                    },
                ]
            });
        $("#pdf").hide();
        $("#excel").hide();
        $("#print").hide();
    });
    $(document).on('click', '#excel', function () {
        $(".buttons-excel")[0].click();
        $("#pdf").hide();
        $("#excel").hide();
        $("#print").hide();
    });
    $(document).on('click', '#pdf', function () {
        $(".buttons-pdf")[0].click();
        $("#pdf").hide();
        $("#excel").hide();
        $("#print").hide();
    });
    $(document).on('click', '#print', function () {
        $(".buttons-print")[0].click();
        $("#pdf").hide();
        $("#excel").hide();
        $("#print").hide();
    });
    $(document).on('click', '#export', function () {
        var x = document.getElementById('pdf');
        var y = document.getElementById('excel');
        var z = document.getElementById('print');
        if (x.style.display === "none" && y.style.display === "none" && z.style.display === "none") {
            x.style.display = "inline";
            y.style.display = "inline";
            z.style.display = "inline";
        } else {
            x.style.display = "none";
            y.style.display = "none";
            z.style.display = "none";
        }
    });
</script>
<p>
    <div style="padding-left:0rem">
        <div style="padding-bottom:-10rem">
            <button type="button" class="btn btn-primary" data-toggle="modal" data-target="#addPatient"
                    onclick="createmodal()">
                Add Patient
            </button>
            <button class="btn export" title="Export" id="export" style="margin-left:40px"><span class="glyphicon glyphicon-export"></span></button>
            <i class="btn print bi bi-printer" title="Print" id="print"></i>
            <i class="btn pdf bi bi-filetype-pdf" title="View/Save as PDF" id="pdf"></i>
            <i class="btn excel bi bi-file-earmark-excel" title="Save as Excel" id="excel"></i>
        </div>
    </div>


</p>

<div>

    <table id="myTable" class="display table-bordered" style="width:100%">

        <thead>

            <tr>

                <th>Name</th>
                <th>Age</th>
                <th>Gender</th>
                <th>Department</th>
                <th>Covid Result</th>
                <th>Contact </th>
                <th>In Patient</th>
                <th>Action</th>

            </tr>


        </thead>

    </table>

</div>

<script>
    function createmodal() {
        console.log("create");
        $.get("/Patients/Create", { ActionType: "Add" }, function (result) {
            console.log(result);
            $('#datamodalbody').html(result);
            $('#datamodal').modal('show');
            btnEdit.style.display = "none";
            btnSave.style.display = "none";
        })
    }
    function createPatient() {
        var modal = $("#datamodal");
        var form = $('form[name="addform"]');
       var name= validatename();
       var age= validateage();
       var contact= validatecontact();
        validategender();
        validatedepartment();
         validateresult();
        var data = form.serialize();
        if (name && age && contact ) {
            $.post("/Patients/Create", data, function (res) {
                if (res) {
                    toastr.options = {
                        "closeButton": true,
                        "newestOnTop": false,
                        "progressBar": true,
                        "positionClass": "toast-bottom-right",
                        "preventDuplicates": false,
                        "onclick": null,
                        "showDuration": "200",
                        "hideDuration": "1000",
                        "timeOut": "3000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    }
                    toastr["success"]("Patient added successfully!")

                   
                    modal.modal('hide');
                    dataTable.ajax.reload(null,false);
                }
            })
        }
    }
    function viewPatient(id) {
        $.get("/Patients/Edit", { operation:"Edit",id:id }, function (result) {
            $('#datamodalbody').html(result);
            $('#datamodal').modal('show');
            $('.disable').attr('disabled', true);
            addsave.style.display = "none";
            document.getElementById("btnSave").disabled = true;
            $('#btnEdit').show();
            $('#btnSave').hide();

        })
    }

    function viewEdit(id) {
        $.get("/Patients/Edit", { operation: "Edit", id: id }, function (result) {
            $('#datamodalbody').html(result);
            $('#datamodal').modal('show');
            $('.disable').attr('disabled', false);
            addsave.style.display = "none";
            document.getElementById("btnSave").disabled = false;
            $('#btnEdit').hide();

        })
    }

    function editPatient() {
        $('.disable').attr('disabled', false);
        document.getElementById("btnSave").disabled = false;
        $('#btnSave').show();
        $('#btnEdit').hide();
        


    }
    function updatePatient() {
        var modal = $("#datamodal");
        var form = $('form[name="addform"]');
        var data = form.serialize();
        var name = validatename();
        var age = validateage();
        var contact = validatecontact();
        validatedepartment();
        validategender();
        validateresult();
        if (name && age && contact) {
            $.post("/Patients/Edit", data, function (res) {
                if (res) {                  
                    toastr.options = {
                        "closeButton": true,
                        "newestOnTop": false,
                        "progressBar": true,
                        "positionClass": "toast-bottom-right",
                        "preventDuplicates": false,
                        "onclick": null,
                        "showDuration": "200",
                        "hideDuration": "1000",
                        "timeOut": "3000",
                        "extendedTimeOut": "1000",
                        "showEasing": "swing",
                        "hideEasing": "linear",
                        "showMethod": "fadeIn",
                        "hideMethod": "fadeOut"
                    }
                    toastr["success"]("Patient updated successfully!")

                    $("#datamodal").modal('hide');
                    dataTable.ajax.reload(null,false);
                }
            })
        }
    }
    function viewdelete(id) {
        $.get("/Patients/Delete", { id: id }, function (res) {
            if (res) {
                $('#datamodalbody').html(res);
            $('#datamodal').modal('show');
            }
        })
    }
    function DeletePatient() {
        var modal = $("#datamodal");
        var form = $('form[name="delete"]');
        var data = form.serialize();
        $.post("/Patients/Delete", data, function (res) {
            if (res) {
                toastr.options = {
                    "closeButton": true,
                    "newestOnTop": false,
                    "progressBar": true,
                    "positionClass": "toast-bottom-right",
                    "preventDuplicates": false,
                    "onclick": null,
                    "showDuration": "200",
                    "hideDuration": "1000",
                    "timeOut": "3000",
                    "extendedTimeOut": "1000",
                    "showEasing": "swing",
                    "hideEasing": "linear",
                    "showMethod": "fadeIn",
                    "hideMethod": "fadeOut"
                }
                toastr["error"]("Patient deleted successfully!")

                modal.modal('hide');
               dataTable.ajax.reload(null,false);
            }
        })
    }
</script>
<div class="modal fade" id="datamodal" tabindex="-1" data-backdrop="static" data-keyboard="false" role="dialog" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog " role="document">
        <div class="modal-content" id="datamodalbody">

        </div>
    </div>
</div>